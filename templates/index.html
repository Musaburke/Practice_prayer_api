<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Prayer Times</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg: #f7f8fa; --text: #0f172a; --muted: #475569; --card: #ffffff;
    --primary: #2563eb; --primary-weak: #dbeafe; --border: #e2e8f0;
    --table-stripe: #f8fafc; --shadow: 0 10px 25px rgba(2,6,23,0.08); --radius:14px;
}
@media (prefers-color-scheme: dark){
:root {
    --bg:#0b1220;--text:#e5e7eb;--muted:#94a3b8;--card:#0f172a;
    --primary:#60a5fa;--primary-weak:#0b1220;--border:#1f2937;
    --table-stripe:#0b1220;--shadow:0 10px 25px rgba(0,0,0,0.4);
}}
body {
    margin:0;font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:radial-gradient(1200px 600px at 10% -10%, var(--primary-weak), transparent) no-repeat,var(--bg);
    color: var(--text); line-height:1.5;
}
.container{max-width:760px;margin:48px auto;padding:0 20px;}
.header{text-align:center;margin-bottom:24px;}
.title{font-size:2rem;font-weight:700;margin:0 0 8px;}
.subtitle{color:var(--text);margin:0;}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
.card-section{padding:20px;}
form{display:grid;gap:12px;}
.form-row{display:grid;grid-template-columns:1fr;gap:12px;}
@media (min-width:560px){.form-row{grid-template-columns:1fr 1fr;}}
label{font-size:0.9rem;font-weight:600;margin-bottom:6px;display:inline-block;color:var(--text);}
.input-group{display:flex;flex-direction:column;}
input[type="text"], select{
    width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--text);
    outline:none;transition:border-color 0.2s,box-shadow 0.2s;
}
input[type="text"]::placeholder{color:var(--text);opacity:0.7;}
input[type="text"]:focus, select:focus{border-color:var(--primary);box-shadow:0 0 0 4px color-mix(in srgb,var(--primary)20%,transparent);}
button[type="submit"], button[type="button"]{
    padding:12px 16px;border:1px solid transparent;border-radius:10px;font-weight:600;cursor:pointer;transition:transform 0.02s ease,box-shadow 0.2s,background 0.2s;
}
button[type="submit"]{background:var(--primary);color:white;box-shadow:0 6px 16px rgba(37,99,235,0.25);}
button[type="submit"]:hover{transform:translateY(-1px);}
button[type="submit"]:active{transform:translateY(0);}
button[type="submit"]:focus-visible{outline:none;box-shadow:0 0 0 4px color-mix(in srgb,var(--primary)25%,transparent);}
button[type="button"]{background:#f3f4f6;color:#6b7280;margin-left:10px;border:1px solid #d1d5db;}
button[type="button"]:hover{background:#e5e7eb;color:#4b5563;}
.table-wrap{overflow-x:auto;margin-top:16px;}
table{width:100%;border-collapse:collapse;min-width:360px;}
th, td{text-align:left;padding:14px 16px;border-bottom:1px solid var(--border);}
thead th{background:var(--primary);font-weight:700;color:white;}
tbody tr:nth-child(even) td{background:var(--table-stripe);}
tbody tr:hover td{background:color-mix(in srgb,var(--primary-weak)60%,transparent);}
tbody td{color:var(--text);}
.highlight{background:color-mix(in srgb,var(--primary)30%,transparent);}
.section-heading{font-size:1.125rem;font-weight:700;margin:0 0 8px;color:white;}
.meta{color:var(--text);margin:0 0 16px;}
.footer-note{font-size:0.85rem;color:var(--muted);text-align:center;margin-top:16px;}
#countdown{font-weight:600;color:var(--primary);}
#error{color:red;margin-bottom:10px;}
</style>
</head>
<body>
<div class="container">
<header class="header">
<h1 class="title">Prayer Times</h1>
<p class="subtitle">Enter your city and country to fetch todayâ€™s times</p>
</header>

<section class="card">
<div class="card-section">
{% if error_message %}
<div id="error">{{ error_message }}</div>
{% endif %}
<form method="POST" novalidate>
    <div class="form-row">
        <div class="input-group">
            <label for="city">City</label>
            <input id="city" type="text" name="city" placeholder="e.g. London" required value="{{ city }}">
        </div>
        <div class="input-group">
            <label for="country">Country</label>
            <input id="country" type="text" name="country" placeholder="e.g. United Kingdom" required value="{{ country }}">
        </div>
    </div>
    <div class="form-row">
        <div class="input-group">
            <label for="method">Calculation Method</label>
            <select name="method" id="method">
                {% for method in methods %}
                    <option value="{{ method }}" {% if method==method_name %}selected{% endif %}>{{ method }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="form-row" style="margin-top:12px;">
        <button type="submit">Get Prayer Times</button>
        <button type="button" onclick="resetForm()">Reset</button>
    </div>
</form>
</div>

{% if prayer_times %}
<hr style="border:none;border-top:1px solid var(--border);margin:0;">
<div class="card-section">
<h2 class="section-heading">Prayer Times for {{ city }}, {{ country }}</h2>
<p class="meta">Hijri Date: {{ hijri_date }} | All times local</p>
<div class="table-wrap">
<table id="prayerTable" role="table" aria-label="Prayer times">
<thead>
<tr><th>Prayer</th><th>Time</th></tr>
</thead>
<tbody>
{% for prayer in ['Fajr','Dhuhr','Asr','Maghrib','Isha'] %}
<tr><td>{{ prayer }}</td><td>{{ prayer_times[prayer] }}</td></tr>
{% endfor %}
</tbody>
</table>
</div>
<p class="meta">Next Prayer: <span id="nextPrayer"></span> in <span id="countdown"></span></p>
<p class="footer-note">Check your local masjid for method adjustments if needed.</p>
</div>
{% endif %}
</section>
</div>

<script>
function updateNextPrayer() {
    const table = document.getElementById("prayerTable");
    if(!table) return;
    const rows = table.querySelectorAll("tbody tr");
    const now = new Date();
    let nextPrayerName = "";
    let nextTime = null;

    rows.forEach(row => row.classList.remove("highlight"));
    rows.forEach(row => {
        const timeParts = row.cells[1].textContent.split(":");
        const prayerTime = new Date();
        prayerTime.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]),0,0);
        if(prayerTime>now && (nextTime===null || prayerTime<nextTime)){
            nextTime = prayerTime;
            nextPrayerName = row.cells[0].textContent;
        }
    });
    if(nextTime){
        document.getElementById("nextPrayer").textContent = nextPrayerName;
        rows.forEach(row=>{if(row.cells[0].textContent===nextPrayerName) row.classList.add("highlight");});
        let diff = Math.floor((nextTime-now)/1000);
        let h = Math.floor(diff/3600); diff%=3600;
        let m = Math.floor(diff/60); let s = diff%60;
        document.getElementById("countdown").textContent = `${h}h ${m}m ${s}s`;
    }
}
setInterval(updateNextPrayer,1000);

// Auto-detect location
window.addEventListener("load",()=>{
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            fetch(`https://geocode.xyz/${pos.coords.latitude},${pos.coords.longitude}?geoit=json`)
            .then(res=>res.json())
            .then(data=>{
                if(!document.getElementById("city").value) document.getElementById("city").value=data.city || "";
                if(!document.getElementById("country").value) document.getElementById("country").value=data.country || "";
            }).catch(e=>{});
        });
    }
});

// Reset form and table
function resetForm() {
    document.getElementById("city").value = "";
    document.getElementById("country").value = "";
    document.getElementById("method").selectedIndex = 0;
    document.getElementById("nextPrayer").textContent = "";
    document.getElementById("countdown").textContent = "";
    const table = document.getElementById("prayerTable");
    if(table){
        table.querySelector("tbody").innerHTML = "";
    }
}
</script>
</body>
</html>